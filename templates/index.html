<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloudma</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>
                <svg class="header-icon" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                Cloudma
            </h1>
            <div class="header-controls">
                <button id="theme-toggle" class="theme-toggle" title="Toggle theme">
                    <svg id="theme-icon" viewBox="0 0 24 24">
                        <path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                    <span id="theme-text">Light</span>
                </button>
                <button id="settings-toggle" class="theme-toggle" title="AI Settings">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                    </svg>
                    AI Option
                </button>
                <button id="history-toggle" class="theme-toggle" title="Report History">
                    <svg viewBox="0 0 24 24" width="16" height="16" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>
                    </svg>
                    History
                </button>
                <div class="search-container">
                    <input type="text" id="search-input" placeholder="Search for a city..." autocomplete="off">
                    <button id="search-btn">Search</button>
                    <div id="search-results" class="search-results"></div>
                </div>
            </div>
        </header>

        <!-- AI Settings Panel -->
        <div id="ai-settings-panel" class="ai-settings-panel hidden">
            <div class="ai-settings-content">
                <h4>AI Configuration</h4>
                <div class="settings-row">
                    <label for="ollama-url">Ollama URL:</label>
                    <input type="text" id="ollama-url" value="http://localhost:11434" placeholder="http://localhost:11434">
                </div>
                <div class="settings-row">
                    <label for="ollama-api-key">API Key (optional):</label>
                    <input type="password" id="ollama-api-key" placeholder="Leave empty if not required">
                </div>
                <div class="settings-actions">
                    <button id="test-ai-connection" class="settings-btn">Test Connection</button>
                    <button id="save-ai-settings" class="settings-btn primary">Save & Connect</button>
                    <button id="cancel-ai-settings" class="settings-btn">Cancel</button>
                </div>
                <div id="test-result" class="test-result hidden"></div>
            </div>
        </div>

        <!-- Report History Panel -->
        <div id="history-panel" class="history-panel hidden">
            <div class="history-header">
                <h4>Report History</h4>
                <div class="history-controls">
                    <button id="clear-history" class="history-btn danger" title="Clear All">
                        <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                        </svg>
                    </button>
                    <button id="close-history" class="history-btn" title="Close">×</button>
                </div>
            </div>
            <div class="history-list" id="history-list">
                <div class="history-empty">No reports yet. Generate a prediction to see it here.</div>
            </div>
        </div>

        <main>
            <div class="map-container">
                <div id="map"></div>
                <div class="map-instructions">Click on the map to get weather data</div>
            </div>

            <div class="weather-panel">
                <div id="location-info">
                    <h2 id="location-name">Select a location</h2>
                    <p id="location-coords"></p>
                </div>

                <div id="current-weather" class="weather-card hidden">
                    <h3>Current Weather</h3>
                    <div class="current-main">
                        <div class="temp-display">
                            <span id="current-temp">--</span>°C
                        </div>
                        <div class="weather-icon" id="weather-icon">
                            <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/></svg>
                        </div>
                    </div>
                    <div class="weather-description" id="weather-desc">--</div>
                    <div class="weather-details">
                        <div class="detail-item">
                            <span class="label">Feels Like</span>
                            <span id="feels-like">--°C</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Humidity</span>
                            <span id="humidity">--%</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Wind</span>
                            <span id="wind">-- km/h</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Pressure</span>
                            <span id="pressure">-- hPa</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Precipitation</span>
                            <span id="precipitation">-- mm</span>
                        </div>
                        <div class="detail-item">
                            <span class="label">Cloud Cover</span>
                            <span id="cloud-cover">--%</span>
                        </div>
                    </div>
                </div>

                <div id="forecast" class="forecast-card hidden">
                    <h3>7-Day Forecast</h3>
                    <div id="forecast-list" class="forecast-list"></div>
                </div>

                <!-- AI Prediction Section -->
                <div id="ai-section" class="ai-card hidden">
                    <div class="ai-header">
                        <h3>
                            <svg class="ai-icon" viewBox="0 0 24 24">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                            </svg>
                            AI Weather Prediction
                        </h3>
                        <div class="ai-status" id="ai-status">
                            <span class="status-dot"></span>
                            <span id="ai-status-text">Checking...</span>
                        </div>
                    </div>
                    
                    <div class="ai-controls">
                        <div class="model-selector">
                            <label for="ai-model">Model:</label>
                            <select id="ai-model" disabled>
                                <option value="">Select model...</option>
                            </select>
                        </div>
                        <button id="ai-predict-btn" class="ai-btn" disabled>
                            <svg viewBox="0 0 24 24">
                                <path d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Predict Future Weather
                        </button>
                    </div>
                    
                    <!-- AI Prediction Popup Window -->
                    <div id="ai-prediction-popup" class="ai-popup hidden">
                        <div class="ai-popup-header" id="ai-popup-header">
                            <div class="ai-popup-title">
                                <svg viewBox="0 0 24 24" width="16" height="16">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                                </svg>
                                <span>AI Prediction Results</span>
                                <span id="ai-model-used" class="ai-model-tag"></span>
                            </div>
                            <div class="ai-popup-controls">
                                <button class="ai-popup-btn save" id="ai-popup-save" title="Save Report">
                                    <svg viewBox="0 0 24 24" width="14" height="14" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                                        <polyline points="17 21 17 13 7 13 7 21"/>
                                        <polyline points="7 3 7 8 15 8"/>
                                    </svg>
                                </button>
                                <button class="ai-popup-btn minimize" id="ai-popup-minimize" title="Minimize">−</button>
                                <button class="ai-popup-btn close" id="ai-popup-close" title="Close">×</button>
                            </div>
                        </div>
                        <div class="ai-popup-toolbar">
                            <div class="language-selector">
                                <label for="ai-language">Language:</label>
                                <select id="ai-language">
                                    <option value="en">English</option>
                                    <option value="fr">Français</option>
                                    <option value="es">Español</option>
                                    <option value="de">Deutsch</option>
                                    <option value="it">Italiano</option>
                                    <option value="pt">Português</option>
                                    <option value="ru">Русский</option>
                                    <option value="zh">中文</option>
                                    <option value="ja">日本語</option>
                                    <option value="ko">한국어</option>
                                    <option value="ar">العربية</option>
                                    <option value="hi">हिन्दी</option>
                                </select>
                                <button id="ai-translate-btn" class="translate-btn" title="Translate">
                                    <svg viewBox="0 0 24 24" width="14" height="14">
                                        <path d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l.67-2h4.67l.66 2h2l-3.5-12zm-2.33 8L17 13l1.17 5h-2z"/>
                                    </svg>
                                    Translate
                                </button>
                            </div>
                        </div>
                        <div class="ai-popup-content" id="ai-prediction-content"></div>
                        <div class="ai-popup-resize-handle"></div>
                    </div>
                    
                    <div id="ai-loading" class="ai-loading hidden">
                        <div class="spinner"></div>
                        <p>AI is analyzing historical data and predicting future weather...</p>
                        <p class="ai-thinking">This may take 30-60 seconds depending on the model</p>
                    </div>
                    
                    <div id="ai-error" class="ai-error hidden">
                        <p id="ai-error-text"></p>
                    </div>
                </div>

                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <p>Loading weather data...</p>
                </div>

                <div id="error" class="error hidden">
                    <p>Failed to load weather data. Please try again.</p>
                </div>
            </div>
        </main>

        <footer>
            <p>Powered by <a href="https://open-meteo.com/" target="_blank">Open-Meteo</a> | Cloudma Weather App</p>
        </footer>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
</body>
</html>
